Lesson 2

Forms - apply to work for uncle snoop

[workbook 2 - work for snoop](https://github.com/nikfrank/react-course-workbook-2)


Agenda:

- concepts: using setState for forms
- getting started step: clicking a button
- step 0: user input from our input boxes (( style ))
- step 1: Dropdown selections (( style ))
- step 2: Validation (( style error message to be a pop-up box ))
- step 3: Date inputs

- step 4: clicking on snoop: Simple React Components
- step 5: toastr for failed submission


##### git cheat sheet

[git cheat sheet](./lessons/git.md)


### installation

```
$ cd ~/code/react-course
$ git clone https://github.com/nikfrank/react-course-workbook-2
$ cd react-course-workbook-2
$ yarn
$ npm start
```

### concepts: using `setState` for forms

Here we're going to do a bunch of super useful examples of getting data from users!

But to jazz it up, we're making an application form for a job in [tha dogg pound](https://en.wikipedia.org/wiki/Tha_Dogg_Pound)


#### state, onChange

we learned already that everything the user sees has to be from the state.

So in React every time the user types even one character, we need that in the state.


To take text input from a user, we're going to make an ```<input/>``` rendering a ```value``` prop from ```.state``` and an ```onChange``` eventHandler function to react to typing

This pattern is standard in React and goes by the name: [controlled input pattern](https://reactjs.org/docs/forms.html)

Data comes in through the ```onChange``` eventHandler, and only renders to the input box if our eventHandler function saves the new ```value``` into the ```.state```


```js
class App extends Component {
  state = { someWord: '' }

  // event.target.value is where React sends our new value
  // that's what we'll save to state:
  
  wordChanged = (event)=> this.setState({ someWord: event.target.value })

  render(){
    const { someWord } = this.state;

    return (
      <input value={someWord} onChange={this.wordChanged} />
    );
  }
}
```


React only lets us [make changes to state using](https://reactjs.org/docs/faq-state.html) a Component's ```this.setState``` function

Our ```onChange``` eventHandler function ```this.wordChanged``` updates our ```.state``` on every text input change.

Then we render the new value into ```<input value={ HERE }/>``` the input's value prop.


We'll use this same pattern for inputs of all sorts
- dropdowns ```<select value={} onChange={}>...option tags...</select>```
- inputs from npm modules like ```<DatePicker value={} onChange={}/>```
- custom Components we'll write (who will call this.props.onChange from inside)

---


ok, the actual lesson:

### getting started step: clicking a button

```$ git checkout start```

here we're going to put an initial state and bind our submit button's onClick to a function that logs out the state

we'll worry about implementing onChange handlers later - our goal here is just to confirm that React works! (hopefully it still does)


#### initial state

we already have an inital state, it's just empty!

./src/App.js
```js
class App extends Component {
  state = {}

  //...
}
```

so let's put in some initial values for the ```.rapName``` and ```.albumSales``` to render

./src/App.js
```js
class App extends Component {
  state = {
    rapName: 'Mikey G',
    albumSales: 420,
  }

  //...
}
```

let's render those ```.state``` values into our ```<input value={...}/>```s

./src/App.js
```html
<input placeholder='Rap Name'/>
```

./src/App.js
```html
<input placeholder='Rap Name' value={this.state.rapName}/>
```

similarly for the ```.albumSales``` ```<input/>```


#### onClick submit

After the form is filled, we need to respond to the "submit" button's onClick for the user to complete their work.

./src/App.js
```html
<button>Submit</button>
```

we can write

./src/App.js
```html
<button onClick={this.submitForm}>Submit</button>
```

and so we'll also need a submitForm function

./src/App.js
```js
class App extends Component {
  state = {
    rapName: 'Mikey G',
    albumSales: 420,
  }

  submitForm = ()=> {
    console.log( 'send this to the API', this.state );
    console.log( 'using APIs is covered in workbook 4!' );
  }
  
  render(){
    return (
      <div>
        //...
        <button onClick={this.submitForm}>Submit</button>
      </div>
    );
  }
}
```

we can see the state of our form logged in the console (Ctrl Shift i / command option j) when we hit submit

next up, user input!


### step 0: user input from our input boxes

if you're starting from this step

```$ git checkout step0```

[git cheat sheet](./lessons/git.md)

---


ok, now we want the user's input to be set in the state so it can be rendered back to the user (which is what they expect to happen!)

just like we saw in the conecpts section, we'll be adding onChange callback props to all of our inputs

./src/App.js
```html
<input placeholder='Rap Name' value={this.state.rapName}/>
```

we can bind our onChange handler (which doesn't exist yet)

./src/App.js
```html
<input placeholder='Rap Name'
       onChange={this.setRapName}
       value={this.state.rapName}/>
```

and so we'll need to write our ```this.setRapName``` eventHandler as an instance method

./src/App.js
```js
class App extends Component {
  //...
  
  submitForm = ()=> {
    console.log( this.state );
  }
  
  //...
}
```

```this.submitForm``` is an instance method, so let's put our new one next to it

./src/App.js
```js
class App extends Component {
  //...

  setRapName = (event)=> this.setState({ rapName: event.target.value })

  submitForm = ()=> {
    console.log( this.state );
  }
  
  //...
}
```

now when we hit submit, we should see the new value for ```.rapName``` logged as part of the state object

you can do the same for ```.albumSales```! (make sure to name your eventHandler function well)


#### step 1: Dropdown selections

if you're starting from this step

```$ git checkout step1```

[git cheat sheet](./lessons/git.md)

---


Snoop is going to want to know more than a name and a number!

He also has a list of open positions to apply to, and is going to want to know where you're from (country / state)

first let's add a field to our init state

./src/App.js
```js
//...
  state = {
    rapName: '',
    albumSales: 0,
    applyingFor: '',
  }
//...
```

and a [select tag](https://reactjs.org/docs/forms.html#the-select-tag) with our options

into the rendered JSX

./src/App.js
```html
//...

    <div className='form-field'>
      <select>
        <option value=''>Select Position</option>
        <option value='driver'>Driver</option>
        <option value='trafficker'>Trafficker</option>
        <option value='producer'>Producer</option>
        <option value='rapper'>Rapper</option>
      </select>
    </div>

//...
```

now all we need is an onChange and value prop just like our last examples!

./src/App.js
```html
//...

    <select value={this.state.applyingFor} onChange={this.setApplyingFor}>
      //...
    </select>
//...
```

we'll need to write the ```this.setApplyingFor``` function, but you knew that already!



#### Conditional Rendering

Sometimes we want to only render an element for certain ```state```s

Let's make another dropdown to select our Country

./src/App.js
```js
//...
  state = {
    //...
    country: '',
  }

  setCountry = (event)=> this.setState({ country: event.target.value })

//...

            <select value={this.state.country}
                    onChange={this.setCountry}>
              <option value=''>Select Country</option>
              <option value='USA'>USA</option>
              <option value='Canada'>Canada</option>
              <option value='Israel'>Israel</option>
            </select>
//...
```


Here, only when ```country === 'USA'``` are we going to want a ```<select/>``` for State

( later, we could choose the options for State based on the country, this is the simpler exercise to start with )

Using [react's docs for conditional rendering](https://reactjs.org/docs/conditional-rendering.html#inline-if-with-logical--operator) we see it's pretty easy to render our State select based on our ```this.state.country```

./src/App.js
```js
{
  (this.state.country === 'USA') ? (
    <div className='form-field'>
      <select value={this.state.whichState}
              onChange={this.setWhichState}>
        <option value=''>Select State</option>
        <option value='CA'>California</option>
        <option value='NY'>New York</option>
        <option value='MI'>Michigan</option>
      </select>
    </div>
  ) : null
}
```

here we're using the ternary expression (inline if statement):
- when country is 'USA', the expression evaluates to a select tag (before the :)
- otherwise, the expression evaluates to ```null```, which in JSX means "render nothing"

to solve the naming issue with "State", I've named the field ```.whichState``` and the onChange handler ```this.setWhichState``` to avoid overwriting ```this.setState```. Perhaps this is why Canada calls them "provinces"


it's a good time to write a bit of style for our ```<select>``` boxes

./src/App.css
```css

```


#### step 2: Validation

if you're starting from this step

```$ git checkout step2```

[git cheat sheet](./lessons/git.md)

---


Snoop wants us to validate our input!

Rap Names **must** contain "gg"

also, Snoop wants applicants to provide a valid email address.

What we need to do is every time the value changes, we'll set the value AND calculate another value for the state like ```isRapNameValid```, which we'll use to conditionally render a validation message to the user:


./src/App.js
```js
  setRapName = (event)=>
    this.setState({
      rapName: event.target.value,
      isRapNameValid: event.target.value.includes('gg') && (event.target.value.length > 2),
    })
```

and in our render function (perhaps right after the input box)


./src/App.js
```js
{
  !this.state.isRapNameValid ? (
    <div className='invalid-field-warning'>
      Rap Name must contain "gg"
    </div>
  ) : null
}
```

the entire flow for the email field will be left to the reader

checking that an email is valid is best done with a [regex](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions)

[here's a standard email regex](http://emailregex.com/)

in the solution for the step (```git checkout step3```) I've also added styling for the invalid-field-warning className, so it will look like a problem (red)

if you don't want to cheat by reading the solution but need some direction in [how to use a regex in js to calculate a boolean based on matching it against a string... you can go ahead and google it](https://www.google.com/search?q=how+to+use+a+regex+in+js+to+calculate+a+boolean+based+on+matching+it+against+a+string)



Snoop wants our submit ```<button>``` to be disabled when there is invalid data in our state

./src/App.js
```html
<button onClick={this.submitForm}
        disabled={!this.state.isEmailValid ||
                  !this.state.isRapNameValid ||
                  !this.state.applyingFor ||
                  !this.state.country ||
                  (this.state.country ==='USA' && !this.state.whichState)}>
  Submit
</button>
```

not too shabby! We're checking that the form is filled AND the fields with validation have passed.



### step 3: Date inputs

if you're starting from this step
`
``$ git checkout step3```

[git cheat sheet](./lessons/git.md)

---


Snoop wants to know when you can start working!

To make our life easy, we're not going to build a datepicker from scratch - that'd be reinventing the wheel!

Instead, we're going to use [Hacker0x01's popular react-datepicker module](https://github.com/Hacker0x01/react-datepicker)

```$ yarn add react-datepicker moment```

the react-datepicker docs should give you all you need to pick a date and put it in the state!


the team that wrote react-datepicker made their ```<DatePicker/>``` Component using the same controlled input pattern, which should make it very easy to use

---


to check a solution for step 3, ```git checkout step4```

if you have a bug getting the date from the ```<DatePicker/>``` HINT: check the [react-datepicker docs example](https://www.npmjs.com/package/react-datepicker)

---



### step 4: clicking on snoop: Simple React Components

Snoop wants us to randomize the colors on his portrait when we click it.

The ```<Snoop/>``` component which came with this workbook is currently using hard-coded colors:

./src/App.js
```js
//...

  <Snoop color='purple' faceColor='white' className='snoop-logo'/>

//...
```

If we want to be able to change those values during runtime, we'll need to render them from ```state``` of course!

./src/App.js
```js
//...

  state = {
    //...
    snoopColor: 'purple',
    snoopFaceColor: 'white',
  }

//...

  <Snoop color={this.state.snoopColor} faceColor={this.state.snoopFaceColor}
         className='snoop-logo'/>

//...
```

So it's still hard-coded, but now we'll be able to write an event handler to change the colors (responding to clicking the logo):


./src/App.js
```js
//...

const snoopColors = ['red', 'purple', 'white', 'black', 'orange', '#0c0'];

class App extends Component {
//...

  onChangeSnoopColor = ()=> {
    const colorIndex = Math.floor( Math.random() * snoopColors.length );
    
    const newColor = snoopColors[ colorIndex ];
    const newFaceColor = snoopColors[ (colorIndex +1) % snoopColors.length ];
    
    this.setState({ snoopColor: newColor, snoopFaceColor: newFaceColor });
  }

//...
```

Of course, we'll need to pass this function to ```<Snoop/>``` as a prop and bind it to the svg element inside ```./src/snoop.svg.js```

./src/App.js
```js
//...

  <Snoop color={this.state.snoopColor} faceColor={this.state.snoopFaceColor}
         className='snoop-logo' onClick={this.onChangeSnoopColor}/>

//...
```

./src/snoop.svg.js
```js
import React from 'react';

export default ({ color='black', faceColor='white', className='', onClick=(()=>0) })=> (
  <svg x="0px" y="0px" viewBox="0 0 100 125"
       className={className}
       onClick={onClick}
       enableBackground="new 0 0 100 100">
     //...
//...
```

What fun!

If you're wondering what

```js
({ onClick=(()=>0) })=> //...
```

means, let's walk through it:

- we're defining a function ```()=> //...```
- destructuring ```onClick``` from the first param (props) ```({ onClick })=> //...```
- setting a default value for ```onClick```:  ```({ onClick=(...) })=> //...```
- the default value is a function that suddenly returns 0
  - ```({ onClick=(()=>0) })=> //...```
- we're setting the default value in case there isn't a prop set, we won't through errors


---


### step 5, toastr for failing submission

Snoop doesn't like the disabled submit button - he'd rather have the button always work, and if there's a validation issue a notification popup (called a toastr on the streets)




[back to index](https://github.com/nikfrank/react-course)

[prev lesson](./1.md)

[next lesson](./3.md)